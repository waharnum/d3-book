<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Pie layout</title>
		<script type="text/javascript" src="d3/d3.js"></script>
		<style type="text/css">

			text {
				font-family: sans-serif;
				font-size: 12px;
				fill: white;
			}

		</style>
	</head>
	<body>
		<p id="add">
			Click to add.
		</p>
		<p id="subtract">
			Click to subtract.
		</p>
		<script type="text/javascript">
			var randomInteger = function(min, max) {
				return Math.floor(Math.random() * (max - min)) + min;
			}
			//Width and height
			var w = 500;
			var h = 500;

			var dataset = [
										{label: "iPhone", value: 400},
										{label: "Android", value: 370},
										{label: "Windows Phone", value: 25},
										{label: "Blackberry", value:87}
										];

			var outerRadius = w / 2;
			var innerRadius = 0;
			var arc = d3.svg.arc()
							.innerRadius(innerRadius)
							.outerRadius(outerRadius);

			var pie = d3.layout.pie()
									.value(function(d) { return d.value });

			//Easy colors accessible via a 20-step ordinal scale
			var color = d3.scale.category20();

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Create table element
			var table = d3.select("body")
										.append("table")
										.append("tbody");

			//Set up groups
			var arcs = svg.selectAll("g.arc")
						  .data(pie(dataset))
						  .enter()
						  .append("g")
						  .attr("class", "arc")
						  .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

			//Set up table
			var rows = table.selectAll("tbody tr")
											 .data(dataset)
											 .enter()
											 .append("tr")
											 .html(function(d, i) {
											 		return "<td>"+d.label+"</td>"+
																 "<td>"+d.value+"</td>"+
																 "<td style='background-color:"+color(i)+";'>&nbsp;&nbsp;&nbsp;&nbsp;</td>";
											 });


			//Draw arc paths
			arcs.append("path")
			    .attr("fill", function(d, i) {
			    	return color(i);
			    })
			    .attr("d", arc);

			//Labels
			arcs.append("text")
			    .attr("transform", function(d) {
			    	return "translate(" + arc.centroid(d) + ")";
			    })
			    .attr("text-anchor", "middle")
			    .text(function(d) {
						// return d.data.label;
						return d.value;
			    });

			d3.selectAll("p")
				.on("click", function() {
					paragraphId = this.id;
					if(paragraphId == "add") {
						newValue = {label: "Random Phone", value: randomInteger(50,250)};
						// newValue = randomInteger(0,30);
						dataset.push(newValue);
					} else if(paragraphId == "subtract") {
						dataset.pop();
					}
						var arcs = svg.selectAll("g.arc")
						              .data(pie(dataset));

						arcs.select("path")
						.attr("d", arc);

						arcs.select("text")
						.attr("transform", function(d) {
					    	return "translate(" + arc.centroid(d) + ")";
					    })

						var newArcs = arcs.enter()
						    .append("g")
								.attr("class", "arc")
								.attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

								newArcs.append("path")
								.attr("fill", function(d, i) {
									return color(i);
								})
								.attr("d", arc)

						    newArcs.append("text")
						    .attr("transform", function(d) {
						    	return "translate(" + arc.centroid(d) + ")";
						    })
						    .attr("text-anchor", "middle")
						    .text(function(d) {
						    	// return d.data.label;
									return d.value;
						    });

						var removedArcs = arcs.exit()
									.remove("g");

						var rows = table.selectAll("tbody tr")
														 .data(dataset);

						var newRows = rows.enter()
																.append("tr")
																.html(function(d, i) {
																	 return "<td>"+d.label+"</td>"+
																					"<td>"+d.value+"</td>"+
																					"<td style='background-color:"+color(i)+";'>&nbsp;&nbsp;&nbsp;&nbsp;</td>";
																});

						var removedRows = rows.exit()
																.remove("tr");

				});

		</script>
	</body>
</html>
